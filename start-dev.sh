#!/bin/bash

# Netflix Clone - Development Server Startup Script

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘         ğŸ¬ Netflix Clone - Development Environment            â•‘"
echo "â•‘                                                                â•‘"
echo "â•‘  This script will start both the backend and frontend servers  â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Check if Node.js is installed
if ! command -v node &> /dev/null; then
    echo "âœ— Error: Node.js is not installed or not in PATH"
    echo ""
    echo "Please install Node.js from https://nodejs.org/"
    exit 1
fi

echo "âœ“ Node.js version:"
node --version
echo ""

# Start backend server
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "âš™ï¸  STARTING BACKEND SERVER ON PORT 5000..."
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

cd server

if [ ! -d "node_modules" ]; then
    echo "ğŸ“¦ Installing backend dependencies..."
    npm install
    echo ""
fi

echo "Starting server..."
npm start &
BACKEND_PID=$!
sleep 3

# Start frontend
cd ..

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸ¨ STARTING FRONTEND SERVER ON PORT 3000..."
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

if [ ! -d "node_modules" ]; then
    echo "ğŸ“¦ Installing frontend dependencies..."
    npm install
    echo ""
fi

echo "Starting development server..."
npm run dev &
FRONTEND_PID=$!

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘  âœ“ Both servers are starting...                               â•‘"
echo "â•‘                                                                â•‘"
echo "â•‘  ğŸ”— Frontend:  http://localhost:3000                           â•‘"
echo "â•‘  ğŸ”— Backend:   http://localhost:5000                           â•‘"
echo "â•‘  ğŸ—„ï¸  Database:  Aiven MySQL Connected                          â•‘"
echo "â•‘                                                                â•‘"
echo "â•‘  ğŸ“š Documentation: See AUTHENTICATION_SETUP.md                 â•‘"
echo "â•‘                                                                â•‘"
echo "â•‘  Press Ctrl+C to stop all servers                              â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Wait for signals
wait
